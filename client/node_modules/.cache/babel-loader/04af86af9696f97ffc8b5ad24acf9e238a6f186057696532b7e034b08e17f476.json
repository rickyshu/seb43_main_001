{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nvar lodash_1 = require(\"lodash\");\nvar Quill = require(\"quill\");\nvar DefaultOptions_1 = require(\"./DefaultOptions\");\nvar DisplaySize_1 = require(\"./modules/DisplaySize\");\nvar Resize_1 = require(\"./modules/Resize\");\nvar Toolbar_1 = require(\"./modules/Toolbar\");\nvar knownModules = {\n  DisplaySize: DisplaySize_1.DisplaySize,\n  Resize: Resize_1.Resize,\n  Toolbar: Toolbar_1.Toolbar\n};\n/**\r\n * Enables Image Resizing on image elements in a Quill.Editor\r\n *\r\n * @export\r\n * @class ImageResize\r\n */\nvar ImageResize = /** @class */function () {\n  function ImageResize(quill, options) {\n    this.instance = quill;\n    // Merge default options, overwrite with any passed in options\n    this._options = lodash_1.merge({}, DefaultOptions_1.DefaultOptions, options);\n    this.listeners = {\n      onRootClick: this.onRootClick(),\n      onKeyUp: this.onKeyUp()\n    };\n    // Disable native image resize in firefox\n    document.execCommand('enableObjectResizing', false, 'false');\n    this.instance.root.addEventListener('click', this.listeners.onRootClick, false);\n    this.instance.root.parentElement.style.position = this.instance.root.parentElement.style.position || 'relative';\n    this.modules = [];\n  }\n  /**\r\n   * Re-initialize all internal modules, to active them\r\n   *\r\n   * @private\r\n   *\r\n   * @memberof ImageResize\r\n   */\n  ImageResize.prototype.initModules = function () {\n    var self = this;\n    this.destroyModules();\n    if (this._options.modules) this.modules = this._options.modules.map(function (mclass) {\n      return new (knownModules[mclass] || mclass)(self);\n    });\n    this.modules.forEach(function (module) {\n      module.onCreate();\n    });\n    this.onUpdate();\n  };\n  ImageResize.prototype.destroyModules = function () {\n    this.modules.forEach(function (module) {\n      module.onDestroy();\n    });\n    this.modules = [];\n  };\n  /**\r\n   * Event Handler to run when an element is clicked inside the Quill editor\r\n   * Checks if the selected element is an image, and creates an overlay of the selected element\r\n   *\r\n   * @private\r\n   * @returns {(evt: Event) => void}\r\n   *\r\n   * @memberof ImageResize\r\n   */\n  ImageResize.prototype.onRootClick = function () {\n    var self = this;\n    return function (event) {\n      if (event.target && event.target['tagName'] && event.target['tagName'].toUpperCase() === 'IMG') {\n        if (self.currentSelectedImage === event.target) return; // Focuse is already up and running\n        else if (self.currentSelectedImage) self.hideSelection();\n        self.showSelection(event.target);\n      } else if (self.currentSelectedImage) self.hideSelection();\n    };\n  };\n  /**\r\n   * Hide the active overlay of active image\r\n   *\r\n   * @private\r\n   * @returns\r\n   *\r\n   * @memberof ImageResize\r\n   */\n  ImageResize.prototype.hideSelection = function () {\n    if (!this.currentSelectedImage) return;\n    this.instance.root.parentNode.removeChild(this.currentOverlay);\n    this.currentOverlay = null;\n    document.removeEventListener('keyup', this.listeners.onKeyUp);\n    this.instance.root.removeEventListener('input', this.listeners.onKeyUp);\n    this.userSelectValue = '';\n    this.destroyModules();\n    this.currentSelectedImage = null;\n  };\n  /**\r\n   * SHow the overlay of the image clicked\r\n   *\r\n   * @private\r\n   * @param {HTMLElement} element\r\n   *\r\n   * @memberof ImageResize\r\n   */\n  ImageResize.prototype.showSelection = function (element) {\n    this.currentSelectedImage = element;\n    if (this.currentOverlay) this.hideSelection();\n    this.instance.setSelection(null);\n    this.userSelectValue = 'none';\n    document.addEventListener('keyup', this.listeners.onKeyUp, true);\n    this.instance.root.addEventListener('input', this.listeners.onKeyUp, true);\n    this.createOverlayElement();\n    this.instance.root.parentNode.appendChild(this.currentOverlay);\n    this.reposition();\n    this.initModules();\n  };\n  ImageResize.prototype.createOverlayElement = function () {\n    this.currentOverlay = document.createElement('div');\n    lodash_1.assign(this.currentOverlay.style, this._options.overlayStyles);\n    return this.currentOverlay;\n  };\n  /**\r\n   * Repositions the overlay, to follow the bound of the selected image\r\n   *\r\n   * @private\r\n   * @returns\r\n   *\r\n   * @memberof ImageResize\r\n   */\n  ImageResize.prototype.reposition = function () {\n    if (!this.currentOverlay || !this.currentSelectedImage) return;\n    var parent = this.instance.root.parentElement;\n    var imgRect = this.currentSelectedImage.getBoundingClientRect();\n    var containerRect = parent.getBoundingClientRect();\n    var repositionData = {\n      left: imgRect.left - containerRect.left - 1 + parent.scrollLeft + \"px\",\n      top: imgRect.top - containerRect.top + parent.scrollTop + \"px\",\n      width: imgRect.width + \"px\",\n      height: imgRect.height + \"px\"\n    };\n    lodash_1.assign(this.currentOverlay.style, repositionData);\n  };\n  /**\r\n   * Updates each internal module\r\n   *\r\n   * @memberof ImageResize\r\n   */\n  ImageResize.prototype.onUpdate = function () {\n    this.reposition();\n    this.modules.forEach(function (module) {\n      module.onUpdate();\n    });\n  };\n  Object.defineProperty(ImageResize.prototype, \"userSelectValue\", {\n    set: function (value) {\n      var self = this;\n      ['userSelect', 'mozUserSelect', 'webkitUserSelect', 'msUserSelect'].forEach(function (key) {\n        self.instance.root.style[key] = value;\n        document.documentElement.style[key] = value;\n      });\n    },\n    enumerable: true,\n    configurable: true\n  });\n  /**\r\n   * Key Handler, for removing an image when DELETE or BACKSPACE is pressed\r\n   *\r\n   * @private\r\n   * @returns {(event: KeyboardEvent) => void}\r\n   *\r\n   * @memberof ImageResize\r\n   */\n  ImageResize.prototype.onKeyUp = function () {\n    var self = this;\n    var KEYCODE_BACKSPACE = 8;\n    var KEYCODE_DELETE = 46;\n    return function (event) {\n      if (self.currentSelectedImage) {\n        if (event.keyCode === KEYCODE_DELETE || event.keyCode === KEYCODE_BACKSPACE) Quill.find(self.currentSelectedImage).deleteAt(0);\n      }\n    };\n  };\n  Object.defineProperty(ImageResize.prototype, \"overlay\", {\n    get: function () {\n      return this.currentOverlay;\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(ImageResize.prototype, \"image\", {\n    get: function () {\n      return this.currentSelectedImage;\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(ImageResize.prototype, \"options\", {\n    get: function () {\n      return this._options;\n    },\n    enumerable: true,\n    configurable: true\n  });\n  return ImageResize;\n}();\nexports.ImageResize = ImageResize;","map":{"version":3,"names":["lodash_1","require","Quill","DefaultOptions_1","DisplaySize_1","Resize_1","Toolbar_1","knownModules","DisplaySize","Resize","Toolbar","ImageResize","quill","options","instance","_options","merge","DefaultOptions","listeners","onRootClick","onKeyUp","document","execCommand","root","addEventListener","parentElement","style","position","modules","prototype","initModules","self","destroyModules","map","mclass","forEach","module","onCreate","onUpdate","onDestroy","event","target","toUpperCase","currentSelectedImage","hideSelection","showSelection","parentNode","removeChild","currentOverlay","removeEventListener","userSelectValue","element","setSelection","createOverlayElement","appendChild","reposition","createElement","assign","overlayStyles","parent","imgRect","getBoundingClientRect","containerRect","repositionData","left","scrollLeft","top","scrollTop","width","height","Object","defineProperty","set","value","key","documentElement","KEYCODE_BACKSPACE","KEYCODE_DELETE","keyCode","find","deleteAt","get","exports"],"sources":["../src/ImageResize.ts"],"sourcesContent":[null],"mappings":";;;;;AAAA,IAAAA,QAAA,GAAAC,OAAA;AACA,IAAAC,KAAA,GAAAD,OAAA;AACA,IAAAE,gBAAA,GAAAF,OAAA;AACA,IAAAG,aAAA,GAAAH,OAAA;AACA,IAAAI,QAAA,GAAAJ,OAAA;AACA,IAAAK,SAAA,GAAAL,OAAA;AAGA,IAAMM,YAAY,GAAO;EAAEC,WAAW,EAAAJ,aAAA,CAAAI,WAAA;EAAEC,MAAM,EAAAJ,QAAA,CAAAI,MAAA;EAAEC,OAAO,EAAAJ,SAAA,CAAAI;AAAA,CAAE;AA+BzD;;;;;;AAMA,IAAAC,WAAA;EAWI,SAAAA,YAAYC,KAAqB,EAAEC,OAAwB;IACvD,IAAI,CAACC,QAAQ,GAAGF,KAAK;IACrB;IACA,IAAI,CAACG,QAAQ,GAAGf,QAAA,CAAAgB,KAAK,CAAC,EAAE,EAAEb,gBAAA,CAAAc,cAAc,EAAEJ,OAAO,CAAC;IAElD,IAAI,CAACK,SAAS,GAAG;MACbC,WAAW,EAAE,IAAI,CAACA,WAAW,EAAE;MAC/BC,OAAO,EAAE,IAAI,CAACA,OAAO;KACxB;IAED;IACAC,QAAQ,CAACC,WAAW,CAAC,sBAAsB,EAAE,KAAK,EAAE,OAAO,CAAC;IAE5D,IAAI,CAACR,QAAQ,CAACS,IAAI,CAACC,gBAAgB,CAAC,OAAO,EAAE,IAAI,CAACN,SAAS,CAACC,WAAW,EAAE,KAAK,CAAC;IAC/E,IAAI,CAACL,QAAQ,CAACS,IAAI,CAACE,aAAa,CAACC,KAAK,CAACC,QAAQ,GAAG,IAAI,CAACb,QAAQ,CAACS,IAAI,CAACE,aAAa,CAACC,KAAK,CAACC,QAAQ,IAAI,UAAU;IAE/G,IAAI,CAACC,OAAO,GAAG,EAAE;EACrB;EAEA;;;;;;;EAOQjB,WAAA,CAAAkB,SAAA,CAAAC,WAAW,GAAnB;IACI,IAAIC,IAAI,GAAG,IAAI;IACf,IAAI,CAACC,cAAc,EAAE;IAErB,IAAI,IAAI,CAACjB,QAAQ,CAACa,OAAO,EACrB,IAAI,CAACA,OAAO,GAAG,IAAI,CAACb,QAAQ,CAACa,OAAO,CAACK,GAAG,CACpC,UAAUC,MAA4B;MAClC,OAAO,KAAK3B,YAAY,CAAS2B,MAAM,CAAC,IAAIA,MAAM,EAAEH,IAAI,CAAC;IAC7D,CAAC,CACJ;IAEL,IAAI,CAACH,OAAO,CAACO,OAAO,CAAC,UAAUC,MAAmB;MAC9CA,MAAM,CAACC,QAAQ,EAAE;IACrB,CAAC,CAAC;IACF,IAAI,CAACC,QAAQ,EAAE;EACnB,CAAC;EAEO3B,WAAA,CAAAkB,SAAA,CAAAG,cAAc,GAAtB;IACI,IAAI,CAACJ,OAAO,CAACO,OAAO,CAAC,UAAUC,MAAmB;MAC9CA,MAAM,CAACG,SAAS,EAAE;IACtB,CAAC,CAAC;IACF,IAAI,CAACX,OAAO,GAAG,EAAE;EACrB,CAAC;EAED;;;;;;;;;EASQjB,WAAA,CAAAkB,SAAA,CAAAV,WAAW,GAAnB;IACI,IAAIY,IAAI,GAAG,IAAI;IAEf,OAAO,UAAUS,KAAY;MACzB,IAAIA,KAAK,CAACC,MAAM,IAAID,KAAK,CAACC,MAAM,CAAC,SAAS,CAAC,IAAID,KAAK,CAACC,MAAM,CAAC,SAAS,CAAC,CAACC,WAAW,EAAE,KAAK,KAAK,EAAE;QAE5F,IAAIX,IAAI,CAACY,oBAAoB,KAAKH,KAAK,CAACC,MAAM,EAC1C,OAAO,CAAC;QAAA,KACP,IAAIV,IAAI,CAACY,oBAAoB,EAC9BZ,IAAI,CAACa,aAAa,EAAE;QAExBb,IAAI,CAACc,aAAa,CAAcL,KAAK,CAACC,MAAM,CAAC;MACjD,CAAC,MACI,IAAIV,IAAI,CAACY,oBAAoB,EAC9BZ,IAAI,CAACa,aAAa,EAAE;IAC5B,CAAC;EACL,CAAC;EAED;;;;;;;;EAQQjC,WAAA,CAAAkB,SAAA,CAAAe,aAAa,GAArB;IACI,IAAI,CAAC,IAAI,CAACD,oBAAoB,EAC1B;IAEJ,IAAI,CAAC7B,QAAQ,CAACS,IAAI,CAACuB,UAAU,CAACC,WAAW,CAAC,IAAI,CAACC,cAAc,CAAC;IAC9D,IAAI,CAACA,cAAc,GAAG,IAAI;IAE1B3B,QAAQ,CAAC4B,mBAAmB,CAAC,OAAO,EAAE,IAAI,CAAC/B,SAAS,CAACE,OAAO,CAAC;IAC7D,IAAI,CAACN,QAAQ,CAACS,IAAI,CAAC0B,mBAAmB,CAAC,OAAO,EAAE,IAAI,CAAC/B,SAAS,CAACE,OAAO,CAAC;IAEvE,IAAI,CAAC8B,eAAe,GAAG,EAAE;IAEzB,IAAI,CAAClB,cAAc,EAAE;IACrB,IAAI,CAACW,oBAAoB,GAAG,IAAI;EACpC,CAAC;EAED;;;;;;;;EAQQhC,WAAA,CAAAkB,SAAA,CAAAgB,aAAa,GAArB,UAAsBM,OAAoB;IACtC,IAAI,CAACR,oBAAoB,GAAGQ,OAAO;IAEnC,IAAI,IAAI,CAACH,cAAc,EACnB,IAAI,CAACJ,aAAa,EAAE;IAExB,IAAI,CAAC9B,QAAQ,CAACsC,YAAY,CAAC,IAAI,CAAC;IAChC,IAAI,CAACF,eAAe,GAAG,MAAM;IAE7B7B,QAAQ,CAACG,gBAAgB,CAAC,OAAO,EAAE,IAAI,CAACN,SAAS,CAACE,OAAO,EAAE,IAAI,CAAC;IAChE,IAAI,CAACN,QAAQ,CAACS,IAAI,CAACC,gBAAgB,CAAC,OAAO,EAAE,IAAI,CAACN,SAAS,CAACE,OAAO,EAAE,IAAI,CAAC;IAE1E,IAAI,CAACiC,oBAAoB,EAAE;IAC3B,IAAI,CAACvC,QAAQ,CAACS,IAAI,CAACuB,UAAU,CAACQ,WAAW,CAAC,IAAI,CAACN,cAAc,CAAC;IAE9D,IAAI,CAACO,UAAU,EAAE;IACjB,IAAI,CAACzB,WAAW,EAAE;EACtB,CAAC;EAEOnB,WAAA,CAAAkB,SAAA,CAAAwB,oBAAoB,GAA5B;IACI,IAAI,CAACL,cAAc,GAAG3B,QAAQ,CAACmC,aAAa,CAAC,KAAK,CAAC;IACnDxD,QAAA,CAAAyD,MAAM,CAAC,IAAI,CAACT,cAAc,CAACtB,KAAK,EAAE,IAAI,CAACX,QAAQ,CAAC2C,aAAa,CAAC;IAE9D,OAAO,IAAI,CAACV,cAAc;EAC9B,CAAC;EAED;;;;;;;;EAQQrC,WAAA,CAAAkB,SAAA,CAAA0B,UAAU,GAAlB;IACI,IAAI,CAAC,IAAI,CAACP,cAAc,IAAI,CAAC,IAAI,CAACL,oBAAoB,EAClD;IAEJ,IAAIgB,MAAM,GAAG,IAAI,CAAC7C,QAAQ,CAACS,IAAI,CAACE,aAAa;IAC7C,IAAImC,OAAO,GAAa,IAAI,CAACjB,oBAAqB,CAACkB,qBAAqB,EAAE;IAC1E,IAAIC,aAAa,GAAGH,MAAM,CAACE,qBAAqB,EAAE;IAElD,IAAIE,cAAc,GAAG;MACjBC,IAAI,EAAKJ,OAAO,CAACI,IAAI,GAAGF,aAAa,CAACE,IAAI,GAAG,CAAC,GAAGL,MAAM,CAACM,UAAU,OAAI;MACtEC,GAAG,EAAKN,OAAO,CAACM,GAAG,GAAGJ,aAAa,CAACI,GAAG,GAAGP,MAAM,CAACQ,SAAS,OAAI;MAC9DC,KAAK,EAAKR,OAAO,CAACQ,KAAK,OAAI;MAC3BC,MAAM,EAAKT,OAAO,CAACS,MAAM;KAC5B;IAEDrE,QAAA,CAAAyD,MAAM,CAAC,IAAI,CAACT,cAAc,CAACtB,KAAK,EAAEqC,cAAc,CAAC;EACrD,CAAC;EAED;;;;;EAKOpD,WAAA,CAAAkB,SAAA,CAAAS,QAAQ,GAAf;IACI,IAAI,CAACiB,UAAU,EAAE;IAEjB,IAAI,CAAC3B,OAAO,CAACO,OAAO,CAAC,UAAUC,MAAmB;MAC9CA,MAAM,CAACE,QAAQ,EAAE;IACrB,CAAC,CAAC;EACN,CAAC;EAEDgC,MAAA,CAAAC,cAAA,CAAY5D,WAAA,CAAAkB,SAAA,mBAAe;SAA3B,SAAA2C,CAA4BC,KAAa;MACrC,IAAI1C,IAAI,GAAG,IAAI;MACf,CAAC,YAAY,EAAE,eAAe,EAAE,kBAAkB,EAAE,cAAc,CAAC,CAACI,OAAO,CAAC,UAAUuC,GAAW;QAC7F3C,IAAI,CAACjB,QAAQ,CAACS,IAAI,CAACG,KAAK,CAACgD,GAAG,CAAC,GAAGD,KAAK;QACrCpD,QAAQ,CAACsD,eAAe,CAACjD,KAAK,CAACgD,GAAG,CAAC,GAAGD,KAAK;MAC/C,CAAC,CAAC;IACN,CAAC;;;;EAED;;;;;;;;EAQQ9D,WAAA,CAAAkB,SAAA,CAAAT,OAAO,GAAf;IACI,IAAIW,IAAI,GAAG,IAAI;IACf,IAAM6C,iBAAiB,GAAG,CAAC;IAC3B,IAAMC,cAAc,GAAG,EAAE;IAEzB,OAAO,UAAUrC,KAAoB;MACjC,IAAIT,IAAI,CAACY,oBAAoB,EAAE;QAC3B,IAAIH,KAAK,CAACsC,OAAO,KAAKD,cAAc,IAAIrC,KAAK,CAACsC,OAAO,KAAKF,iBAAiB,EACjE1E,KAAM,CAAC6E,IAAI,CAAChD,IAAI,CAACY,oBAAoB,CAAC,CAACqC,QAAQ,CAAC,CAAC,CAAC;MAChE;IAEJ,CAAC;EACL,CAAC;EAEDV,MAAA,CAAAC,cAAA,CAAW5D,WAAA,CAAAkB,SAAA,WAAO;SAAlB,SAAAoD,CAAA;MACI,OAAO,IAAI,CAACjC,cAAc;IAC9B,CAAC;;;;EAEDsB,MAAA,CAAAC,cAAA,CAAW5D,WAAA,CAAAkB,SAAA,SAAK;SAAhB,SAAAoD,CAAA;MACI,OAAO,IAAI,CAACtC,oBAAoB;IACpC,CAAC;;;;EAED2B,MAAA,CAAAC,cAAA,CAAW5D,WAAA,CAAAkB,SAAA,WAAO;SAAlB,SAAAoD,CAAA;MACI,OAAO,IAAI,CAAClE,QAAQ;IACxB,CAAC;;;;EACL,OAAAJ,WAAC;AAAD,CAAC,CAlOD;AAAauE,OAAA,CAAAvE,WAAA,GAAAA,WAAA"},"metadata":{},"sourceType":"script","externalDependencies":[]}